<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Kết quả Bầu cử Ban Hành Giáo - Giáo xứ Thánh Tâm</title>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/odometer.js/0.4.8/themes/odometer-theme-default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/odometer.js/0.4.8/odometer.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: url('background1.png') no-repeat center center fixed;
      background-size: cover;
      padding: 20px;
      text-align: center;
    }
    h1 {
      color: green;
    }
    .main-layout {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin: auto;
    }
    .container_big{
          width: 1070px;
    padding-left: 12px;
    }
    .container {
      display: grid;
    grid-template-columns: repeat(4, 1fr);
    padding-top: 442px;
    }
    .container1 {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 68px;
      flex: 1;
      padding-top: 272px;    
    }
    .candidate_vu_hoang_long {
         padding: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .candidate_nguyen_ngoc_oanh{
         padding: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .candidate_nguyen_huy_trung {
         padding: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .candidate_nguyen_van_duc {
    padding: 10px;
    width: 72%;
    display: flex;
    align-items: center;
    justify-content: center;
    }
    .candidate_bui_quoc_duc {
         padding: 10px;
    width: 82%;
    display: flex;
    align-items: center;
    justify-content: center;
    }
    .candidate_nguyen_quoc_hung {
    padding: 10px;
    width: 77%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding-left: 23px;
    }
    .candidate1 {
      padding: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .candidate2 {
    padding: 10px;
    align-items: center;
    padding-left: 8px;
    justify-content: center;
}
    .candidate3 {
    padding: 10px;
    align-items: center;
        padding-left: 18px;
    padding-right: 66px;
    justify-content: center;
}
    .candidate4 {
    padding: 10px;
    align-items: center;
        padding-left: 18px;
    padding-right: 55px;
    justify-content: center;
}
    .candidate5 {
    padding: 10px;
    align-items: center;
    padding-left: 18px;
    justify-content: center;
}
    .vote-number {
      font-size: 28px;
      font-weight: bold;
      color: red;
    }
    #chart-container {
      flex-basis: 654px;
    padding: 20px 10px 20px 20px;
    padding-top: 280px;
    max-width: 678px;
    max-height: 650px;
    }
    .fix1{
      width: 62%;
    }
    canvas {
      width: 100% !important;
      height: 100% !important;
    }
    @media (max-width: 1000px) {
      .main-layout {
        flex-direction: column;
        align-items: center;
      }
      .container {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    @media (max-width: 600px) {
      .container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
    <div class="main-layout">
      <div class="container_big">
    <div class="container">
      <div class="candidate_nguyen_van_duc"><div class="vote-number odometer" id="num-0">0</div></div>
      <div class="candidate_bui_quoc_duc"><div class="vote-number odometer" id="num-1">0</div></div>
      <div class="candidate_nguyen_quoc_hung"><div class="vote-number odometer" id="num-2">0</div></div>
    </div>
      
      <div class="candidate2"><div class="vote-number fix1 odometer" id="num-3">0</div></div>
      <div class="candidate_vu_hoang_long"><div class="vote-number odometer" id="num-4">0</div></div>
      <div class="candidate4"><div class="vote-number odometer" id="num-5">0</div></div>
      <div class="candidate5"><div class="vote-number odometer" id="num-6">0</div></div>
    </div>
      </div>
    <div id="chart-container">
      <canvas id="voteChart"></canvas>
    </div>
  </div>

  <script>
    const sheetID = '1XsQ_v_hOK_K4KRk8GapoS7E3VXr_aUSOx616-ps-Eec';
    const sheetName = 'Sheet1';
    const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?sheet=${sheetName}`;

    let currentVotes = [0, 0, 0, 0, 0, 0, 0];

    async function fetchData() {
      const res = await fetch(url);
      const text = await res.text();
      const json = JSON.parse(text.substr(47).slice(0, -2));
      const row = json.table.rows[1];
      const data = row.c.slice(1, 8).map(cell => cell ? cell.v : 0);

      const labels = [
        "DucNV",
        "DucBQ",
        "HungNQ",
        "HoangPH",
        "LongVH",
        "OanhNN",
        "TrungNH"
      ];

      return { labels, data };
    }

    function animateCount(id, start, end) {
  const el = document.getElementById(id);
  el.innerHTML = end;
}

    async function renderChart() {
      const { labels, data } = await fetchData();

      data.forEach((val, idx) => {
        if (val !== currentVotes[idx]) {
          animateCount(`num-${idx}`, currentVotes[idx], val);
          currentVotes[idx] = val;
        }
      });

      if (window.myChart) {
        window.myChart.data.datasets[0].data = currentVotes;
        window.myChart.update();
      } else {
        window.myChart = new Chart(document.getElementById("voteChart"), {
          type: "bar",
          data: {
            labels,
            datasets: [{
              label: "Số phiếu",
              data: currentVotes,
              backgroundColor: [
                'rgba(54, 162, 235, 0.7)',
                'rgba(255, 206, 86, 0.7)',
                'rgba(75, 192, 192, 0.7)',
                'rgba(153, 102, 255, 0.7)',
                'rgba(255, 159, 64, 0.7)',
                'rgba(0, 128, 0, 0.7)',
                'rgba(128, 0, 128, 0.7)'
              ]
            }]
          },
          options: {
            responsive: true,
            animation: {
              duration: 1000,
              easing: 'easeOutQuart'
            },
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      }
    }

    renderChart();

    setInterval(() => {
      fetchData().then(({ labels, data }) => {
        data.forEach((val, idx) => {
          if (val !== currentVotes[idx]) {
            animateCount(`num-${idx}`, currentVotes[idx], val);
            currentVotes[idx] = val;
          }
        });

        if (window.myChart) {
          window.myChart.data.datasets[0].data = currentVotes;
          window.myChart.update();
        }
      });
    }, 10000);
  </script>
</body>
</html>
